// Data - Constants - Statements

// Badges
const elBadgeTotalCustomers = document.querySelector(SEL_BADGE_TOTAL_CUSTOMERS)
const elBadgeTotalEmployees = document.querySelector(SEL_BADGE_TOTAL_EMPLOYEES)
const elBadgeTotalItemOrder = document.querySelector(SEL_BADGE_TOTAL_ITEM_ORDER)
const elBadgeTotalItems = document.querySelector(SEL_BADGE_TOTAL_ITEMS)
const elBadgeTotalOrders = document.querySelector(SEL_BADGE_TOTAL_ORDERS)

// Buttons
const elButtonAddEmployee = document.querySelector(SEL_BUTTON_ADD_EMPLOYEE)
const elButtonAddItem = document.querySelector(SEL_BUTTON_ADD_ITEM)
const elButtonAddItemOrder = document.querySelector(SEL_BUTTON_ADD_ITEM_ORDER)
const elButtonAddOrder = document.querySelector(SEL_BUTTON_ADD_ORDER)
const elButtonCancelCustomer = document.querySelector(SEL_BUTTON_CANCEL_CUSTOMER)
const elButtonCancelEmployee = document.querySelector(SEL_BUTTON_CANCEL_EMPLOYEE)
const elButtonCancelItem = document.querySelector(SEL_BUTTON_CANCEL_ITEM)
const elButtonCancelItemOrder = document.querySelector(SEL_BUTTON_CANCEL_ITEM_ORDER)
const elButtonCancelOrder = document.querySelector(SEL_BUTTON_CANCEL_ORDER)
const elButtonRegisterCustomer = document.querySelector(SEL_BUTTON_REGISTER_CUSTOMER)

// Forms
const elFormCustomer = document.querySelector(SEL_FORM_CUSTOMER)
const elFormEmployee = document.querySelector(SEL_FORM_EMPLOYEE)
const elFormItem = document.querySelector(SEL_FORM_ITEM)
const elFormItemOrder = document.querySelector(SEL_FORM_ITEM_ORDER)
const elFormOrder = document.querySelector(SEL_FORM_ORDER)
const elFormPaginationCustomer = document.querySelector(SEL_FORM_PAGINATION_CUSTOMER)
const elFormPaginationEmployee = document.querySelector(SEL_FORM_PAGINATION_EMPLOYEE)
const elFormPaginationItem = document.querySelector(SEL_FORM_PAGINATION_ITEM)
const elFormPaginationItemOrder = document.querySelector(SEL_FORM_PAGINATION_ITEM_ORDER)
const elFormPaginationOrder = document.querySelector(SEL_FORM_PAGINATION_ORDER)

// Inputs
const elInputCurrentPageCustomer = document.querySelector(SEL_INPUT_CURRENT_PAGE_CUSTOMER)
const elInputCurrentPageEmployee = document.querySelector(SEL_INPUT_CURRENT_PAGE_EMPLOYEE)
const elInputCurrentPageItem = document.querySelector(SEL_INPUT_CURRENT_PAGE_ITEM)
const elInputCurrentPageItemOrder = document.querySelector(SEL_INPUT_CURRENT_PAGE_ITEM_ORDER)
const elInputCurrentPageOrder = document.querySelector(SEL_INPUT_CURRENT_PAGE_ORDER)
const elInputCustomerCity = document.querySelector(SEL_INPUT_CUSTOMER_CITY)
const elInputCustomerFirstName = document.querySelector(SEL_INPUT_CUSTOMER_FIRST_NAME)
const elInputCustomerLastName = document.querySelector(SEL_INPUT_CUSTOMER_LAST_NAME)
const elInputCustomerPhoneNumber = document.querySelector(SEL_INPUT_CUSTOMER_PHONE_NUMBER)
const elInputCustomerPostalCode = document.querySelector(SEL_INPUT_CUSTOMER_POSTAL_CODE)
const elInputCustomerRoad = document.querySelector(SEL_INPUT_CUSTOMER_ROAD)
const elInputEmployeeFirstName = document.querySelector(SEL_INPUT_EMPLOYEE_FIRST_NAME)
const elInputEmployeeHireDate = document.querySelector(SEL_INPUT_EMPLOYEE_HIRE_DATE)
const elInputEmployeeLastName = document.querySelector(SEL_INPUT_EMPLOYEE_LAST_NAME)
const elInputEmployeePhoneNumber = document.querySelector(SEL_INPUT_EMPLOYEE_PHONE_NUMBER)
const elInputItemArtist = document.querySelector(SEL_INPUT_ITEM_ARTIST)
const elInputItemAvailableQuantity = document.querySelector(SEL_INPUT_ITEM_AVAILABLE_QUANTITY)
const elInputItemOrderQuantity = document.querySelector(SEL_INPUT_ITEM_ORDER_QUANTITY)
const elInputItemPrice = document.querySelector(SEL_INPUT_ITEM_PRICE)
const elInputItemReleaseDate = document.querySelector(SEL_INPUT_ITEM_RELEASE_DATE)
const elInputItemTitle = document.querySelector(SEL_INPUT_ITEM_TITLE)
const elInputOrderDate = document.querySelector(SEL_INPUT_ORDER_DATE)

// Navigation links
const elNavLinkAdministration = document.querySelector(SEL_NAV_LINK_ADMINISTRATION)
const elNavLinkCustomer = document.querySelector(SEL_NAV_LINK_CUSTOMER)
const elNavLinkInventory = document.querySelector(SEL_NAV_LINK_INVENTORY)
const elNavLinkItemOrder = document.querySelector(SEL_NAV_LINK_ITEM_ORDER)
const elNavLinkOrder = document.querySelector(SEL_NAV_LINK_ORDER)

// Pagination
const elPageFirstCustomer = document.querySelector(SEL_PAGE_FIRST_CUSTOMER)
const elPageFirstEmployee = document.querySelector(SEL_PAGE_FIRST_EMPLOYEE)
const elPageFirstItem = document.querySelector(SEL_PAGE_FIRST_ITEM)
const elPageFirstItemOrder = document.querySelector(SEL_PAGE_FIRST_ITEM_ORDER)
const elPageFirstOrder = document.querySelector(SEL_PAGE_FIRST_ORDER)
const elPageLastCustomer = document.querySelector(SEL_PAGE_LAST_CUSTOMER)
const elPageLastEmployee = document.querySelector(SEL_PAGE_LAST_EMPLOYEE)
const elPageLastItem = document.querySelector(SEL_PAGE_LAST_ITEM)
const elPageLastItemOrder = document.querySelector(SEL_PAGE_LAST_ITEM_ORDER)
const elPageLastOrder = document.querySelector(SEL_PAGE_LAST_ORDER)
const elPageNextCustomer = document.querySelector(SEL_PAGE_NEXT_CUSTOMER)
const elPageNextEmployee = document.querySelector(SEL_PAGE_NEXT_EMPLOYEE)
const elPageNextItem = document.querySelector(SEL_PAGE_NEXT_ITEM)
const elPageNextItemOrder = document.querySelector(SEL_PAGE_NEXT_ITEM_ORDER)
const elPageNextOrder = document.querySelector(SEL_PAGE_NEXT_ORDER)
const elPagePreviousCustomer = document.querySelector(SEL_PAGE_PREVIOUS_CUSTOMER)
const elPagePreviousEmployee = document.querySelector(SEL_PAGE_PREVIOUS_EMPLOYEE)
const elPagePreviousItem = document.querySelector(SEL_PAGE_PREVIOUS_ITEM)
const elPagePreviousItemOrder = document.querySelector(SEL_PAGE_PREVIOUS_ITEM_ORDER)
const elPagePreviousOrder = document.querySelector(SEL_PAGE_PREVIOUS_ORDER)

// Screens
const elScreenAdministration = document.querySelector(SEL_SCREEN_ADMINISTRATION)
const elScreenCustomer = document.querySelector(SEL_SCREEN_CUSTOMER)
const elScreenCustomerForm = document.querySelector(SEL_SCREEN_CUSTOMER_FORM)
const elScreenEmployeeForm = document.querySelector(SEL_SCREEN_EMPLOYEE_FORM)
const elScreenInventory = document.querySelector(SEL_SCREEN_INVENTORY)
const elScreenItemForm = document.querySelector(SEL_SCREEN_ITEM_FORM)
const elScreenItemOrder = document.querySelector(SEL_SCREEN_ITEM_ORDER)
const elScreenItemOrderForm = document.querySelector(SEL_SCREEN_ITEM_ORDER_FORM)
const elScreenOrder = document.querySelector(SEL_SCREEN_ORDER)
const elScreenOrderForm = document.querySelector(SEL_SCREEN_ORDER_FORM)

// Selects
const elSelectCustomerProvince = document.querySelector(SEL_SELECT_CUSTOMER_PROVINCE)
const elSelectItemFormat = document.querySelector(SEL_SELECT_ITEM_FORMAT)
const elSelectItemGenre = document.querySelector(SEL_SELECT_ITEM_GENRE)
const elSelectItemOrderItemId = document.querySelector(SEL_SELECT_ITEM_ORDER_ITEM_ID)
const elSelectItemOrderOrderId = document.querySelector(SEL_SELECT_ITEM_ORDER_ORDER_ID)
const elSelectOrderCustomer = document.querySelector(SEL_SELECT_ORDER_CUSTOMER)
const elSelectOrderEmployee = document.querySelector(SEL_SELECT_ORDER_EMPLOYEE)
const elSelectOrderPaymentMethod = document.querySelector(SEL_SELECT_ORDER_PAYMENT_METHOD)

// Spans
const elSpanEndPageCustomer = document.querySelector(SEL_SPAN_END_PAGE_CUSTOMER)
const elSpanEndPageEmployee = document.querySelector(SEL_SPAN_END_PAGE_EMPLOYEE)
const elSpanEndPageItem = document.querySelector(SEL_SPAN_END_PAGE_ITEM)
const elSpanEndPageItemOrder = document.querySelector(SEL_SPAN_END_PAGE_ITEM_ORDER)
const elSpanEndPageOrder = document.querySelector(SEL_SPAN_END_PAGE_ORDER)

// Tables
const elTableBodyCustomer = document.querySelector(SEL_TABLE_BODY_CUSTOMER)
const elTableBodyEmployee = document.querySelector(SEL_TABLE_BODY_EMPLOYEE)
const elTableBodyItem = document.querySelector(SEL_TABLE_BODY_ITEM)
const elTableBodyItemOrder = document.querySelector(SEL_TABLE_BODY_ITEM_ORDER)
const elTableBodyOrder = document.querySelector(SEL_TABLE_BODY_ORDER)

// Title
const elTitleApplication = document.querySelector(SEL_TITLE_APPLICATION)

// Others
const I18N = I18N_FR
const URL = "http://127.0.0.1:8000"

// Data - Variables - Statements
let elCurrentNavLink = elNavLinkInventory
let elCurrentScreen = elScreenInventory
let intCurrentPageCustomer = 1
let intCurrentPageEmployee = 1
let intCurrentPageItem = 1
let intCurrentPageItemOrder = 1
let intCurrentPageOrder = 1
let intEndPageCustomer
let intEndPageEmployee
let intEndPageItem
let intEndPageItemOrder
let intEndPageOrder
let intIdCurrentCustomer = 0
let intIdCurrentEmployee = 0
let intIdCurrentItem = 0
let intIdCurrentItemOrder = 0
let intIdCurrentOrder = 0

// Behaviours - Utils

async function initSelects() {
    updateSelect(elSelectItemFormat, await fetchData("/format"))
    updateSelect(elSelectItemGenre, await fetchData("/genre"))
    updateSelect(elSelectOrderPaymentMethod, await fetchData("/payment_method"))
    updateSelect(elSelectCustomerProvince, await fetchData("/province"))
}

async function refreshCustomerTable() {
    let totalCustomers = parseInt((await fetchData(URL + "/customer/count"))[0].count)
    intEndPageCustomer = calculateNumberPages(totalCustomers)
    elSpanEndPageCustomer.textContent = intEndPageCustomer
    elInputCurrentPageCustomer.max = intEndPageCustomer
    elBadgeTotalCustomers.textContent = totalCustomers.toString()
    setPageCustomerTable(intCurrentPageCustomer)
}

async function refreshEmployeeTable() {
    let totalEmployees = parseInt((await fetchData(URL + "/employee/count"))[0].count)
    intEndPageEmployee = calculateNumberPages(totalEmployees)
    elSpanEndPageEmployee.textContent = intEndPageEmployee
    elInputCurrentPageEmployee.max = intEndPageEmployee
    elBadgeTotalEmployees.textContent = totalEmployees.toString()
    setPageEmployeeTable(intCurrentPageEmployee)
}

async function refreshItemTable() {
    let totalItems = parseInt((await fetchData(URL + "/item/count"))[0].count)
    intEndPageItem = calculateNumberPages(totalItems)
    elSpanEndPageItem.textContent = intEndPageItem
    elInputCurrentPageItem.max = intEndPageItem
    elBadgeTotalItems.textContent = totalItems.toString()
    setPageItemTable(intCurrentPageItem)
}

async function refreshItemOrderTable() {
    let totalItemOrders = parseInt((await fetchData(URL + "/order_item/count"))[0].count)
    intEndPageItemOrder = calculateNumberPages(totalItemOrders)
    elSpanEndPageItemOrder.textContent = intEndPageItemOrder
    elInputCurrentPageItemOrder.max = intEndPageItemOrder
    elBadgeTotalItemOrder.textContent = totalItemOrders.toString()
    setPageItemOrderTable(intCurrentPageItemOrder)
}

async function refreshOrderTable() {
    let totalOrders = parseInt((await fetchData(URL + "/orders/count"))[0].count)
    intEndPageOrder = calculateNumberPages(totalOrders)
    elSpanEndPageOrder.textContent = intEndPageOrder
    elInputCurrentPageOrder.max = intEndPageOrder
    elBadgeTotalOrders.textContent = totalOrders.toString()
    setPageOrderTable(intCurrentPageOrder)
}

function refreshInterfaces() {
    elScreenAdministration.style.display = "none"
    elScreenCustomer.style.display = "none"
    elScreenCustomerForm.style.display = "none"
    elScreenEmployeeForm.style.display = "none"
    elScreenInventory.style.display = "none"
    elScreenItemForm.style.display = "none"
    elScreenItemOrder.style.display = "none"
    elScreenItemOrderForm.style.display = "none"
    elScreenOrder.style.display = "none"
    elScreenOrderForm.style.display = "none"
    elCurrentScreen.style.display = "block"
}

function resetForms() {
    elFormCustomer.reset()
    elFormEmployee.reset()
    elFormItem.reset()
    elFormItemOrder.reset()
    elFormOrder.reset()
    intIdCurrentCustomer = 0
    intIdCurrentEmployee = 0
    intIdCurrentItem = 0
    intIdCurrentItemOrder = 0
    intIdCurrentOrder = 0
}

async function setPageCustomerTable(number) {
    intCurrentPageCustomer = number
    elInputCurrentPageCustomer.value = intCurrentPageCustomer
    setPaginationState(elPageFirstCustomer, elPagePreviousCustomer, elPageNextCustomer, elPageLastCustomer,
        intCurrentPageCustomer, intEndPageCustomer)
    let data = await fetchData(URL + "/customer/" + ((intCurrentPageCustomer - 1) * NUMBER_OBJECTS_PER_PAGE) +
        "/" + NUMBER_OBJECTS_PER_PAGE)
    if (data.length === 0) {
        if (intCurrentPageCustomer > 1) {
            intCurrentPageCustomer--
            setPageCustomerTable(intCurrentPageCustomer)
        } else {
            updateTable(elTableBodyCustomer, data)
            listenToTableCustomerBodyEvents()
        }
    } else {
        updateTable(elTableBodyCustomer, data)
        listenToTableCustomerBodyEvents()
    }
}

async function setPageEmployeeTable(number) {
    intCurrentPageEmployee = number
    elInputCurrentPageEmployee.value = intCurrentPageEmployee
    setPaginationState(elPageFirstEmployee, elPagePreviousEmployee, elPageNextEmployee, elPageLastEmployee,
        intCurrentPageEmployee, intEndPageEmployee)
    let data = await fetchData(URL + "/employee/" + ((intCurrentPageEmployee - 1) * NUMBER_OBJECTS_PER_PAGE) +
        "/" + NUMBER_OBJECTS_PER_PAGE)
    if (data.length === 0) {
        if (intCurrentPageEmployee > 1) {
            intCurrentPageEmployee--
            setPageEmployeeTable(intCurrentPageEmployee)
        } else {
            updateTable(elTableBodyEmployee, data)
            listenToTableEmployeeBodyEvents()
        }
    } else {
        updateTable(elTableBodyEmployee, data)
        listenToTableEmployeeBodyEvents()
    }
}

async function setPageItemTable(number) {
    intCurrentPageItem = number
    elInputCurrentPageItem.value = intCurrentPageItem
    setPaginationState(elPageFirstItem, elPagePreviousItem, elPageNextItem, elPageLastItem, intCurrentPageItem,
        intEndPageItem)
    let data = await fetchData(URL + "/item/" + ((intCurrentPageItem - 1) * NUMBER_OBJECTS_PER_PAGE) + "/" +
        NUMBER_OBJECTS_PER_PAGE)
    if (data.length === 0) {
        if (intCurrentPageItem > 1) {
            intCurrentPageItem--
            setPageItemTable(intCurrentPageItem)
        } else {
            updateTable(elTableBodyItem, data)
            listenToTableItemBodyEvents()
        }
    } else {
        updateTable(elTableBodyItem, data)
        listenToTableItemBodyEvents()
    }
}

async function setPageItemOrderTable(number) {
    intCurrentPageItemOrder = number
    elInputCurrentPageItemOrder.value = intCurrentPageItemOrder
    setPaginationState(elPageFirstItemOrder, elPagePreviousItemOrder, elPageNextItemOrder, elPageLastItemOrder,
        intCurrentPageItemOrder, intEndPageItemOrder)
    let data = await fetchData(URL + "/order_item/" + ((intCurrentPageItemOrder - 1) *
        NUMBER_OBJECTS_PER_PAGE) + "/" + NUMBER_OBJECTS_PER_PAGE)
    if (data.length === 0) {
        if (intCurrentPageItemOrder > 1) {
            intCurrentPageItemOrder--
            setPageItemOrderTable(intCurrentPageItemOrder)
        } else {
            updateTable(elTableBodyItemOrder, data)
            listenToTableItemOrderBodyEvents()
        }
    } else {
        updateTable(elTableBodyItemOrder, data)
        listenToTableItemOrderBodyEvents()
    }
}

async function setPageOrderTable(number) {
    intCurrentPageOrder = number
    elInputCurrentPageOrder.value = intCurrentPageOrder
    setPaginationState(elPageFirstOrder, elPagePreviousOrder, elPageNextOrder, elPageLastOrder, intCurrentPageOrder,
        intEndPageOrder)
    let data = await fetchData(URL + "/orders/" + ((intCurrentPageOrder - 1) * NUMBER_OBJECTS_PER_PAGE) +
        "/" + NUMBER_OBJECTS_PER_PAGE)
    if (data.length === 0) {
        if (intCurrentPageOrder > 1) {
            intCurrentPageOrder--
            setPageOrderTable(intCurrentPageOrder)
        } else {
            updateTable(elTableBodyOrder, data)
            listenToTableOrderBodyEvents()
        }
    } else {
        updateTable(elTableBodyOrder, data)
        listenToTableOrderBodyEvents()
    }
}

function setNavLink(navLink) {
    $("#" + elCurrentNavLink.id).removeClass("active")
    elCurrentNavLink = navLink
    $("#" + elCurrentNavLink.id).addClass("active")
}

function setPaginationState(elPageFirst, elPagePrevious, elPageNext, elPageLast, intCurrentPage, intEndPage) {
    elPageFirst.classList.remove("disabled")
    elPagePrevious.classList.remove("disabled")
    elPageNext.classList.remove("disabled")
    elPageLast.classList.remove("disabled")

    if (intCurrentPage === 1) {
        elPageFirst.classList.add("disabled")
        elPagePrevious.classList.add("disabled")
    }

    if (intCurrentPage === intEndPage) {
        elPageNext.classList.add("disabled")
        elPageLast.classList.add("disabled")
    }
}

function setScreen(screen) {
    elCurrentScreen = screen
    elTitleApplication.textContent = document.querySelector("#" + elCurrentScreen.id + " h1").textContent +
        " - Musica"
    resetForms()
    refreshInterfaces()
}

// Procedures - Behaviors

function onButtonDeleteCustomerClick(event, id) {
    event.stopPropagation()
    event.preventDefault()
    sendData(URL + "/customer", HTTP_METHOD_DELETE, {"id": id}).then(() => refreshCustomerTable()
        .then(() => setScreen(elScreenCustomer)))
}

function onButtonDeleteEmployeeClick(event, id) {
    event.stopPropagation()
    event.preventDefault()
    sendData(URL + "/employee", HTTP_METHOD_DELETE, {"id": id}).then(() => refreshEmployeeTable()
        .then(() => setScreen(elScreenAdministration)))
}

function onButtonDeleteItemClick(event, id) {
    event.stopPropagation()
    event.preventDefault()
    sendData(URL + "/item", HTTP_METHOD_DELETE, {"id": id}).then(() => refreshItemTable().then(() =>
        setScreen(elScreenInventory)))
}

function onButtonDeleteItemOrderClick(event, id) {
    event.stopPropagation()
    event.preventDefault()
    sendData(URL + "/order_item", HTTP_METHOD_DELETE, {"id": id}).then(() => refreshItemOrderTable()
        .then(() => setScreen(elScreenItemOrder)))
}

function onButtonDeleteOrderClick(event, id) {
    event.stopPropagation()
    event.preventDefault()
    sendData(URL + "/orders", HTTP_METHOD_DELETE, {"id": id}).then(() => refreshOrderTable().then(() =>
        setScreen(elScreenOrder)))
}

async function onButtonModifyCustomerClick(event, id) {
    let data = (await fetchData("/customer/" + id))[0]
    setScreen(elScreenCustomerForm)
    intIdCurrentCustomer = parseInt(data.id)
    elInputCustomerFirstName.value = data.first_name
    elInputCustomerLastName.value = data.last_name
    elInputCustomerPhoneNumber.value = data.phone
    elInputCustomerRoad.value = data.street
    elInputCustomerCity.value = data.city
    elSelectCustomerProvince.value = data.province_id
    elInputCustomerPostalCode.value = data.postal_code
}

async function onButtonModifyEmployeeClick(event, id) {
    let data = (await fetchData("/employee/" + id))[0]
    setScreen(elScreenEmployeeForm)
    intIdCurrentEmployee = parseInt(data.id)
    elInputEmployeeFirstName.value = data.first_name
    elInputEmployeeLastName.value = data.last_name
    elInputEmployeePhoneNumber.value = data.phone
    elInputEmployeeHireDate.value = data.hire_date
}

async function onButtonModifyItemClick(event, id) {
    let data = (await fetchData("/item/" + id))[0]
    setScreen(elScreenItemForm)
    intIdCurrentItem = parseInt(data.id)
    elInputItemTitle.value = data.title
    elInputItemArtist.value = data.artist
    elInputItemReleaseDate.value = data.release_date
    elSelectItemFormat.value = data.format_id
    elSelectItemGenre.value = data.genre_id
    elInputItemPrice.value = data.price
    elInputItemAvailableQuantity.value = data.quantity
}

async function onButtonModifyItemOrderClick(event, id) {
    let data = (await fetchData("/order_item/" + id))[0]
    setScreen(elScreenItemOrderForm)
    intIdCurrentItemOrder = parseInt(data.id)
    $("#" + elSelectItemOrderOrderId.id).append("<option value='" + data.order_id + "' title='" + data.order +
        "' selected='selected' data-subtext='#" + data.order_id + "'>" + data.order + "</option>").trigger("change")
    $("#" + elSelectItemOrderItemId.id).append("<option value='" + data.item_id + "' title='" + data.item +
        "' selected='selected' data-subtext='#" + data.item_id + "'>" + data.item + "</option>").trigger("change")
    elInputItemOrderQuantity.value = data.quantity
}

async function onButtonModifyOrderClick(event, id) {
    let data = (await fetchData("/orders/" + id))[0]
    setScreen(elScreenOrderForm)
    intIdCurrentOrder = parseInt(data.id)
    $("#" + elSelectOrderEmployee.id).append("<option value='" + data.employee_id + "' title='" + data.employee +
        "' selected='selected' data-subtext='#" + data.employee_id + "'>" + data.employee + "</option>")
        .trigger("change")
    $("#" + elSelectOrderCustomer.id).append("<option value='" + data.customer_id + "' title='" + data.customer +
        "' selected='selected' data-subtext='#" + data.customer_id + "'>" + data.customer + "</option>")
        .trigger("change")
    elInputOrderDate.value = data.order_date
    elSelectOrderPaymentMethod.value = data.payment_method_id
}

function onFormCustomerSubmit(event) {
    event.stopPropagation()
    event.preventDefault()
    sendData(URL + '/customer', ((intIdCurrentCustomer === 0) ? HTTP_METHOD_PUT : HTTP_METHOD_PATCH), {
        "id": intIdCurrentCustomer,
        [elInputCustomerFirstName.id]: elInputCustomerFirstName.value,
        [elInputCustomerLastName.id]: elInputCustomerLastName.value,
        [elInputCustomerPhoneNumber.id]: elInputCustomerPhoneNumber.value,
        [elInputCustomerRoad.id]: elInputCustomerRoad.value,
        [elInputCustomerCity.id]: elInputCustomerCity.value,
        [elSelectCustomerProvince.id]: elSelectCustomerProvince.value,
        [elInputCustomerPostalCode.id]: elInputCustomerPostalCode.value
    }).then(() => refreshCustomerTable().then(() => setScreen(elScreenCustomer)))
}

function onFormEmployeeSubmit(event) {
    event.stopPropagation()
    event.preventDefault()
    sendData(URL + '/employee', ((intIdCurrentEmployee === 0) ? HTTP_METHOD_PUT : HTTP_METHOD_PATCH), {
        "id": intIdCurrentEmployee,
        [elInputEmployeeFirstName.id]: elInputEmployeeFirstName.value,
        [elInputEmployeeLastName.id]: elInputEmployeeLastName.value,
        [elInputEmployeePhoneNumber.id]: elInputEmployeePhoneNumber.value,
        [elInputEmployeeHireDate.id]: elInputEmployeeHireDate.value
    }).then(() => refreshEmployeeTable().then(() => setScreen(elScreenAdministration)))
}

function onFormItemSubmit(event) {
    event.stopPropagation()
    event.preventDefault()
    sendData(URL + "/item", ((intIdCurrentItem === 0) ? HTTP_METHOD_PUT : HTTP_METHOD_PATCH), {
        "id": intIdCurrentItem,
        [elInputItemTitle.id]: elInputItemTitle.value,
        [elInputItemArtist.id]: elInputItemArtist.value,
        [elInputItemReleaseDate.id]: elInputItemReleaseDate.value,
        [elSelectItemFormat.id]: elSelectItemFormat.value,
        [elSelectItemGenre.id]: elSelectItemGenre.value,
        [elInputItemPrice.id]: elInputItemPrice.value,
        [elInputItemAvailableQuantity.id]: elInputItemAvailableQuantity.value
    }).then(() => refreshItemTable().then(() => setScreen(elScreenInventory)))
}

function onFormItemOrderSubmit(event) {
    event.stopPropagation()
    event.preventDefault()
    sendData(URL + '/order_item', ((intIdCurrentItemOrder === 0) ? HTTP_METHOD_PUT : HTTP_METHOD_PATCH), {
        "id": intIdCurrentItemOrder,
        [elSelectItemOrderOrderId.id]: elSelectItemOrderOrderId.value,
        [elSelectItemOrderItemId.id]: elSelectItemOrderItemId.value,
        [elInputItemOrderQuantity.id]: elInputItemOrderQuantity.value
    }).finally(() => refreshItemOrderTable().then(() => setScreen(elScreenItemOrder)))
}

function onFormOrderSubmit(event) {
    event.stopPropagation()
    event.preventDefault()
    sendData(URL + '/orders', ((intIdCurrentOrder === 0) ? HTTP_METHOD_PUT : HTTP_METHOD_PATCH), {
        "id": intIdCurrentOrder,
        [elSelectOrderEmployee.id]: elSelectOrderEmployee.value,
        [elSelectOrderCustomer.id]: elSelectOrderCustomer.value,
        [elInputOrderDate.id]: elInputOrderDate.value,
        [elSelectOrderPaymentMethod.id]: elSelectOrderPaymentMethod.value
    }).then(() => refreshOrderTable().then(() => setScreen(elScreenOrder)))
}

function onFormPaginationCustomerSubmit(event) {
    event.stopPropagation()
    event.preventDefault()
    let page = parseInt(elInputCurrentPageCustomer.value)

    if (1 <= page <= intEndPageCustomer && page !== intCurrentPageCustomer) {
        setPageCustomerTable(page)
    }
}

function onFormPaginationEmployeeSubmit(event) {
    event.stopPropagation()
    event.preventDefault()
    let page = parseInt(elInputCurrentPageEmployee.value)

    if (1 <= page <= intEndPageEmployee && page !== intCurrentPageEmployee) {
        setPageEmployeeTable(page)
    }
}

function onFormPaginationItemSubmit(event) {
    event.stopPropagation()
    event.preventDefault()
    let page = parseInt(elInputCurrentPageItem.value)

    if (1 <= page <= intEndPageItem && page !== intCurrentPageItem) {
        setPageItemTable(page)
    }
}

function onFormPaginationItemOrderSubmit(event) {
    event.stopPropagation()
    event.preventDefault()
    let page = parseInt(elInputCurrentPageItemOrder.value)

    if (1 <= page <= intEndPageItemOrder && page !== intCurrentPageItemOrder) {
        setPageItemOrderTable(page)
    }
}

function onFormPaginationOrderSubmit(event) {
    event.stopPropagation()
    event.preventDefault()
    let page = parseInt(elInputCurrentPageOrder.value)

    if (1 <= page <= intEndPageOrder && page !== intCurrentPageOrder) {
        setPageOrderTable(page)
    }
}

function onPageFirstCustomerClick(event) {
    event.stopPropagation()
    if (intCurrentPageCustomer !== 1) {
        intCurrentPageCustomer = 1
        setPageCustomerTable(intCurrentPageCustomer)
    }

}

function onPagePreviousCustomerClick(event) {
    event.stopPropagation()
    if (intCurrentPageCustomer > 1) {
        intCurrentPageCustomer--
        setPageCustomerTable(intCurrentPageCustomer)
    }
}

function onPageNextCustomerClick(event) {
    event.stopPropagation()
    if (intCurrentPageCustomer < intEndPageCustomer) {
        intCurrentPageCustomer++
        setPageCustomerTable(intCurrentPageCustomer)
    }
}

function onPageLastCustomerClick(event) {
    event.stopPropagation()
    if (intCurrentPageCustomer !== intEndPageCustomer) {
        intCurrentPageCustomer = intEndPageCustomer
        setPageCustomerTable(intCurrentPageCustomer)
    }

}

function onPageFirstEmployeeClick(event) {
    event.stopPropagation()
    if (intCurrentPageEmployee !== 1) {
        intCurrentPageEmployee = 1
        setPageEmployeeTable(intCurrentPageEmployee)
    }

}

function onPagePreviousEmployeeClick(event) {
    event.stopPropagation()
    if (intCurrentPageEmployee > 1) {
        intCurrentPageEmployee--
        setPageEmployeeTable(intCurrentPageEmployee)
    }
}

function onPageNextEmployeeClick(event) {
    event.stopPropagation()
    if (intCurrentPageEmployee < intEndPageEmployee) {
        intCurrentPageEmployee++
        setPageEmployeeTable(intCurrentPageEmployee)
    }
}

function onPageLastEmployeeClick(event) {
    event.stopPropagation()
    if (intCurrentPageEmployee !== intEndPageEmployee) {
        intCurrentPageEmployee = intEndPageEmployee
        setPageEmployeeTable(intCurrentPageEmployee)
    }

}

function onPageFirstItemClick(event) {
    event.stopPropagation()
    if (intCurrentPageItem !== 1) {
        intCurrentPageItem = 1
        setPageItemTable(intCurrentPageItem)
    }

}

function onPagePreviousItemClick(event) {
    event.stopPropagation()
    if (intCurrentPageItem > 1) {
        intCurrentPageItem--
        setPageItemTable(intCurrentPageItem)
    }
}

function onPageNextItemClick(event) {
    event.stopPropagation()
    if (intCurrentPageItem < intEndPageItem) {
        intCurrentPageItem++
        setPageItemTable(intCurrentPageItem)
    }
}

function onPageLastItemClick(event) {
    event.stopPropagation()
    if (intCurrentPageItem !== intEndPageItem) {
        intCurrentPageItem = intEndPageItem
        setPageItemTable(intCurrentPageItem)
    }

}

function onPageFirstItemOrderClick(event) {
    event.stopPropagation()
    if (intCurrentPageItemOrder !== 1) {
        intCurrentPageItemOrder = 1
        setPageItemOrderTable(intCurrentPageItemOrder)
    }

}

function onPagePreviousItemOrderClick(event) {
    event.stopPropagation()
    if (intCurrentPageItemOrder > 1) {
        intCurrentPageItemOrder--
        setPageItemOrderTable(intCurrentPageItemOrder)
    }
}

function onPageNextItemOrderClick(event) {
    event.stopPropagation()
    if (intCurrentPageItemOrder < intEndPageItemOrder) {
        intCurrentPageItemOrder++
        setPageItemOrderTable(intCurrentPageItemOrder)
    }
}

function onPageLastItemOrderClick(event) {
    event.stopPropagation()
    if (intCurrentPageItemOrder !== intEndPageItemOrder) {
        intCurrentPageItemOrder = intEndPageItemOrder
        setPageItemOrderTable(intCurrentPageItemOrder)
    }

}

function onPageFirstOrderClick(event) {
    event.stopPropagation()
    if (intCurrentPageOrder !== 1) {
        intCurrentPageOrder = 1
        setPageOrderTable(intCurrentPageOrder)
    }

}

function onPagePreviousOrderClick(event) {
    event.stopPropagation()
    if (intCurrentPageOrder > 1) {
        intCurrentPageOrder--
        setPageOrderTable(intCurrentPageOrder)
    }
}

function onPageNextOrderClick(event) {
    event.stopPropagation()
    if (intCurrentPageOrder < intEndPageOrder) {
        intCurrentPageOrder++
        setPageOrderTable(intCurrentPageOrder)
    }
}

function onPageLastOrderClick(event) {
    event.stopPropagation()
    if (intCurrentPageOrder !== intEndPageOrder) {
        intCurrentPageOrder = intEndPageOrder
        setPageOrderTable(intCurrentPageOrder)
    }

}

function onNavLinkClick(event, screen, navLink) {
    event.stopPropagation()
    setScreen(screen)
    setNavLink(navLink)
}


// Procedures - Routing

function listenToTableCustomerBodyEvents() {
    elTableBodyCustomer.childNodes.forEach(row => {
        let id = row.firstChild.textContent
        let elButtonModify = row.lastChild.lastChild.firstChild
        let elButtonDelete = row.lastChild.lastChild.lastChild
        elButtonModify.addEventListener(EVENT_JS_CLICK, (e) => onButtonModifyCustomerClick(e, id))
        elButtonDelete.addEventListener(EVENT_JS_CLICK, (e) => onButtonDeleteCustomerClick(e, id))
    })
}

function listenToTableEmployeeBodyEvents() {
    elTableBodyEmployee.childNodes.forEach(row => {
        let id = row.firstChild.textContent
        let elButtonModify = row.lastChild.lastChild.firstChild
        let elButtonDelete = row.lastChild.lastChild.lastChild
        elButtonModify.addEventListener(EVENT_JS_CLICK, (e) => onButtonModifyEmployeeClick(e, id))
        elButtonDelete.addEventListener(EVENT_JS_CLICK, (e) => onButtonDeleteEmployeeClick(e, id))
    })
}

function listenToTableItemBodyEvents() {
    elTableBodyItem.childNodes.forEach(row => {
        let id = row.firstChild.textContent
        let elButtonModify = row.lastChild.lastChild.firstChild
        let elButtonDelete = row.lastChild.lastChild.lastChild
        elButtonModify.addEventListener(EVENT_JS_CLICK, (e) => onButtonModifyItemClick(e, id))
        elButtonDelete.addEventListener(EVENT_JS_CLICK, (e) => onButtonDeleteItemClick(e, id))
    })
}

function listenToTableItemOrderBodyEvents() {
    elTableBodyItemOrder.childNodes.forEach(row => {
        let id = row.firstChild.textContent
        let elButtonModify = row.lastChild.lastChild.firstChild
        let elButtonDelete = row.lastChild.lastChild.lastChild
        elButtonModify.addEventListener(EVENT_JS_CLICK, (e) => onButtonModifyItemOrderClick(e, id))
        elButtonDelete.addEventListener(EVENT_JS_CLICK, (e) => onButtonDeleteItemOrderClick(e, id))
    })
}

function listenToTableOrderBodyEvents() {
    elTableBodyOrder.childNodes.forEach(row => {
        let id = row.firstChild.textContent
        let elButtonModify = row.lastChild.lastChild.firstChild
        let elButtonDelete = row.lastChild.lastChild.lastChild
        elButtonModify.addEventListener(EVENT_JS_CLICK, (e) => onButtonModifyOrderClick(e, id))
        elButtonDelete.addEventListener(EVENT_JS_CLICK, (e) => onButtonDeleteOrderClick(e, id))
    })
}

function listenToEvents() {
    elButtonAddEmployee.addEventListener(EVENT_JS_CLICK, (e) => onNavLinkClick(e, elScreenEmployeeForm, elNavLinkAdministration))
    elButtonAddItem.addEventListener(EVENT_JS_CLICK, (e) => onNavLinkClick(e, elScreenItemForm, elNavLinkInventory))
    elButtonAddItemOrder.addEventListener(EVENT_JS_CLICK, (e) => onNavLinkClick(e, elScreenItemOrderForm, elNavLinkItemOrder))
    elButtonAddOrder.addEventListener(EVENT_JS_CLICK, (e) => onNavLinkClick(e, elScreenOrderForm, elNavLinkOrder))
    elButtonCancelCustomer.addEventListener(EVENT_JS_CLICK, (e) => onNavLinkClick(e, elScreenCustomer, elNavLinkCustomer))
    elButtonCancelEmployee.addEventListener(EVENT_JS_CLICK, (e) => onNavLinkClick(e, elScreenAdministration, elNavLinkAdministration))
    elButtonCancelItem.addEventListener(EVENT_JS_CLICK, (e) => onNavLinkClick(e, elScreenInventory, elNavLinkInventory))
    elButtonCancelItemOrder.addEventListener(EVENT_JS_CLICK, (e) => onNavLinkClick(e, elScreenItemOrder, elNavLinkItemOrder))
    elButtonCancelOrder.addEventListener(EVENT_JS_CLICK, (e) => onNavLinkClick(e, elScreenOrder, elNavLinkOrder))
    elButtonRegisterCustomer.addEventListener(EVENT_JS_CLICK, (e) => onNavLinkClick(e, elScreenCustomerForm, elNavLinkCustomer))
    elFormCustomer.addEventListener(EVENT_JS_SUBMIT, (e) => onFormCustomerSubmit(e))
    elFormEmployee.addEventListener(EVENT_JS_SUBMIT, (e) => onFormEmployeeSubmit(e))
    elFormItem.addEventListener(EVENT_JS_SUBMIT, (e) => onFormItemSubmit(e))
    elFormItemOrder.addEventListener(EVENT_JS_SUBMIT, (e) => onFormItemOrderSubmit(e))
    elFormOrder.addEventListener(EVENT_JS_SUBMIT, (e) => onFormOrderSubmit(e))
    elFormPaginationCustomer.addEventListener(EVENT_JS_SUBMIT, (e) => onFormPaginationCustomerSubmit(e))
    elFormPaginationEmployee.addEventListener(EVENT_JS_SUBMIT, (e) => onFormPaginationEmployeeSubmit(e))
    elFormPaginationItem.addEventListener(EVENT_JS_SUBMIT, (e) => onFormPaginationItemSubmit(e))
    elFormPaginationItemOrder.addEventListener(EVENT_JS_SUBMIT, (e) => onFormPaginationItemOrderSubmit(e))
    elFormPaginationOrder.addEventListener(EVENT_JS_SUBMIT, (e) => onFormPaginationOrderSubmit(e))
    elNavLinkAdministration.addEventListener(EVENT_JS_CLICK, (e) => onNavLinkClick(e, elScreenAdministration, elNavLinkAdministration))
    elNavLinkCustomer.addEventListener(EVENT_JS_CLICK, (e) => onNavLinkClick(e, elScreenCustomer, elNavLinkCustomer))
    elNavLinkInventory.addEventListener(EVENT_JS_CLICK, (e) => onNavLinkClick(e, elScreenInventory, elNavLinkInventory))
    elNavLinkItemOrder.addEventListener(EVENT_JS_CLICK, (e) => onNavLinkClick(e, elScreenItemOrder, elNavLinkItemOrder))
    elNavLinkOrder.addEventListener(EVENT_JS_CLICK, (e) => onNavLinkClick(e, elScreenOrder, elNavLinkOrder))
    elPageFirstCustomer.addEventListener(EVENT_JS_CLICK, (e) => onPageFirstCustomerClick(e))
    elPageFirstEmployee.addEventListener(EVENT_JS_CLICK, (e) => onPageFirstEmployeeClick(e))
    elPageFirstItem.addEventListener(EVENT_JS_CLICK, (e) => onPageFirstItemClick(e))
    elPageFirstItemOrder.addEventListener(EVENT_JS_CLICK, (e) => onPageFirstItemOrderClick(e))
    elPageFirstOrder.addEventListener(EVENT_JS_CLICK, (e) => onPageFirstOrderClick(e))
    elPageLastCustomer.addEventListener(EVENT_JS_CLICK, (e) => onPageLastCustomerClick(e))
    elPageLastEmployee.addEventListener(EVENT_JS_CLICK, (e) => onPageLastEmployeeClick(e))
    elPageLastItem.addEventListener(EVENT_JS_CLICK, (e) => onPageLastItemClick(e))
    elPageLastItemOrder.addEventListener(EVENT_JS_CLICK, (e) => onPageLastItemOrderClick(e))
    elPageLastOrder.addEventListener(EVENT_JS_CLICK, (e) => onPageLastOrderClick(e))
    elPageNextCustomer.addEventListener(EVENT_JS_CLICK, (e) => onPageNextCustomerClick(e))
    elPageNextEmployee.addEventListener(EVENT_JS_CLICK, (e) => onPageNextEmployeeClick(e))
    elPageNextItem.addEventListener(EVENT_JS_CLICK, (e) => onPageNextItemClick(e))
    elPageNextItemOrder.addEventListener(EVENT_JS_CLICK, (e) => onPageNextItemOrderClick(e))
    elPageNextOrder.addEventListener(EVENT_JS_CLICK, (e) => onPageNextOrderClick(e))
    elPagePreviousCustomer.addEventListener(EVENT_JS_CLICK, (e) => onPagePreviousCustomerClick(e))
    elPagePreviousEmployee.addEventListener(EVENT_JS_CLICK, (e) => onPagePreviousEmployeeClick(e))
    elPagePreviousItem.addEventListener(EVENT_JS_CLICK, (e) => onPagePreviousItemClick(e))
    elPagePreviousItemOrder.addEventListener(EVENT_JS_CLICK, (e) => onPagePreviousItemOrderClick(e))
    elPagePreviousOrder.addEventListener(EVENT_JS_CLICK, (e) => onPagePreviousOrderClick(e))
}

// Init

$(SEL_SELECT_ORDER_EMPLOYEE).selectpicker().ajaxSelectPicker({
    ajax: {
        url: URL + "/employee",
        type: "GET",
        data: {
            q: "{{{q}}}"
        }
    },
    preprocessData: function (data) {
        let objects = []

        data.forEach(object => {
            objects.push({
                "value": object.id,
                "text": object.first_name + " " + object.last_name,
                "data": {
                    "subtext": "#" + object.id
                }
            })
        })
        return objects
    }
})

$(SEL_SELECT_ORDER_CUSTOMER).selectpicker().ajaxSelectPicker({
    ajax: {
        url: URL + "/customer",
        type: "GET",
        data: {
            q: "{{{q}}}"
        }
    },
    preprocessData: function (data) {
        let objects = []

        data.forEach(object => {
            objects.push({
                "value": object.id,
                "text": object.first_name + " " + object.last_name,
                "data": {
                    "subtext": "#" + object.id
                }
            })
        })
        return objects
    }
})

$(SEL_SELECT_ITEM_ORDER_ORDER_ID).selectpicker().ajaxSelectPicker({
    ajax: {
        url: URL + "/orders",
        type: "GET",
        data: {
            q: "{{{q}}}"
        }
    },
    preprocessData: function (data) {
        let objects = []

        data.forEach(object => {
            objects.push({
                "value": object.id,
                "text": object.order_date + " " + object.customer,
                "data": {
                    "subtext": "#" + object.id
                }
            })
        })
        return objects
    }
})

$(SEL_SELECT_ITEM_ORDER_ITEM_ID).selectpicker().ajaxSelectPicker({
    ajax: {
        url: URL + "/item",
        type: "GET",
        data: {
            q: "{{{q}}}"
        }
    },
    preprocessData: function (data) {
        let objects = []

        data.forEach(object => {
            objects.push({
                "value": object.id,
                "text": object.title + " par " + object.artist + " (" + object.format + ")",
                "data": {
                    "subtext": "#" + object.id
                }
            })
        })
        return objects
    }
})

internationalizeApplication(I18N)
refreshItemTable()
refreshOrderTable()
refreshItemOrderTable()
refreshCustomerTable()
refreshEmployeeTable()
initSelects()
setScreen(elScreenInventory)
listenToEvents()